# PokemonUltimate - Cursor AI Rules

> **Quick reference for AI assistants. For detailed guidelines, see referenced documents.**

## ğŸš€ Automatic Context Loading

**ALWAYS read at start:**
1. `.ai/context.md` - Current project state
2. `docs/ai/guidelines/project_guidelines.md` - Complete coding rules

**Read on-demand:**
- Feature docs â†’ `docs/features_master_list.md` â†’ `docs/features/[N]-[feature-name]/`
- Code quality â†’ `docs/ai/anti-patterns.md`
- Examples â†’ `docs/ai/examples/good_code.md`
- Feature naming â†’ `docs/ai/guidelines/feature_naming_in_code.md`

## ğŸ“‹ Development Workflow

### When User Says "Implement X" or "Add X"

**MANDATORY WORKFLOW:**

1. **Read Context & Specs**
   - Read `.ai/context.md` and `docs/features_master_list.md`
   - Read `docs/features/[N]-[feature-name]/architecture.md` (always use numbered format)
   - **MANDATORY: Read existing code** - See `code_location.md`, read all related classes
   - Understand existing patterns before writing

2. **Verify Spec Completeness**
   - List what to implement vs defer
   - Complete spec if incomplete

3. **TDD: Write Tests FIRST**
   - Follow `docs/ai/testing_structure_definition.md`
   - Write functional tests (red phase)

4. **Implement Feature**
   - **MANDATORY: Read existing code first** - Match style and patterns
   - **MANDATORY: Add feature references** - ALL code must reference its feature (see `docs/ai/guidelines/feature_naming_in_code.md`)
   - Follow spec and existing patterns
   - Make tests pass (green phase)

5. **Write Edge Case Tests**
   - Test boundaries and invalid inputs
   - Implement missing functionality if discovered

6. **Write Integration Tests** (if feature interacts with multiple systems)
   - Test system interactions
   - Place in `Systems/[Module]/Integration/`

7. **Validate Against Use Cases** (combat features only)
   - Check `docs/combat_use_cases.md`
   - Mark items complete

8. **Verify Implementation**
   - `dotnet build` - 0 warnings
   - `dotnet test` - All pass
   - Check `docs/ai/checklists/feature_complete.md`

9. **Update Documentation**
   - Update `.ai/context.md`
   - Update roadmap if phase complete
   - Mark use cases complete (if applicable)

### When User Says "Review X" or "Check X"
1. Read `docs/ai/anti-patterns.md`
2. Verify against `docs/ai/guidelines/project_guidelines.md`
3. Check `docs/ai/checklists/feature_complete.md`
4. List issues and fix if requested

### When User Says "Refactor X" or "Improve X"
1. **Read current implementation** - All related code files
2. Identify improvements, check `docs/ai/anti-patterns.md`
3. Make small incremental changes
4. Run tests after each change
5. **Ensure feature references exist** - All code must reference its feature

### When Issues Arise

**Spec incomplete** â†’ Complete spec first  
**Spec incorrect** â†’ Document discrepancy, fix spec or implementation  
**Test reveals missing functionality** â†’ Implement immediately (Test-Driven Discovery)  
**Architectural change needed** â†’ Document discovery, evaluate impact, update architecture

## âœ… Mandatory Rules

### Code Quality
- **NO magic strings** â†’ Use `ErrorMessages.cs` or `GameMessages.cs`
- **NO magic numbers** â†’ Use named constants
- **NO try-catch** â†’ Unless absolutely necessary (I/O, external APIs)
- **Fail-fast** â†’ Throw exceptions for invalid inputs
- **Guard clauses** â†’ Validate at method start

### Architecture
- **Core/** â†’ Logic only, NO game data
- **Content/** â†’ Game data, catalogs, builders
- **Tests/** â†’ Systems/, Blueprints/, Data/ (see `docs/ai/testing_structure_definition.md`)
- **Blueprints** â†’ Immutable (no setters)
- **Instances** â†’ Mutable runtime state

### Testing
- **TDD** â†’ Tests before implementation
- **Three-phase** â†’ Functional â†’ Edge Cases â†’ Integration
- **Naming** â†’ `MethodName_Scenario_ExpectedResult`
- **Test-Driven Discovery** â†’ If test reveals missing functionality, implement it
- **Structure** â†’ Follow `docs/ai/testing_structure_definition.md`

### Documentation
- **XML docs** â†’ All public APIs
- **MANDATORY: Feature references** â†’ ALL classes must reference their feature (see `docs/ai/guidelines/feature_naming_in_code.md`)
- **MANDATORY: Read before write** â†’ Never write code without reading existing code first
- **MANDATORY: Match existing patterns** â†’ Follow style, naming, structure of existing code
- **Update context** â†’ After major features

## ğŸ” Quick Reference

### Exception Messages
```csharp
throw new ArgumentException(ErrorMessages.AmountCannotBeNegative, nameof(amount));
```

### Test Pattern
```csharp
[Test]
public void MethodName_Scenario_ExpectedResult() { /* Arrange, Act, Assert */ }
```

### Validation Pattern
```csharp
public void Method(int value) {
    if (value < 0)
        throw new ArgumentException(ErrorMessages.ValueCannotBeNegative, nameof(value));
    // Main logic
}
```

## ğŸ“ Key Files Reference

| Need | Read |
|------|------|
| Project state | `.ai/context.md` |
| Feature numbers/names | `docs/features_master_list.md` â­ **MASTER REFERENCE** |
| Feature documentation standard | `docs/feature_documentation_standard.md` |
| Feature naming in code | `docs/ai/guidelines/feature_naming_in_code.md` â­ **MANDATORY** |
| Coding rules | `docs/ai/guidelines/project_guidelines.md` |
| What NOT to do | `docs/ai/anti-patterns.md` |
| Code examples | `docs/ai/examples/good_code.md` |
| Test examples | `docs/ai/examples/good_tests.md` |
| Pre-implementation | `docs/ai/checklists/pre_implementation.md` |
| Feature checklist | `docs/ai/checklists/feature_complete.md` |
| Test structure | `docs/ai/testing_structure_definition.md` |

**âš ï¸ Feature Documentation**: Always use numbered paths: `docs/features/[N]-[feature-name]/`

## ğŸ”„ After Completing Work

Always:
1. Run `dotnet build` - Verify no warnings
2. Run `dotnet test` - Verify all pass
3. Update `.ai/context.md` if major changes
4. Mention test count in response
5. Verify against `docs/ai/checklists/feature_complete.md`

## âš¡ Quick Verification Checklist

Before marking feature complete:
- [ ] All tests pass (`dotnet test`)
- [ ] No warnings (`dotnet build`)
- [ ] `.ai/context.md` updated
- [ ] Use cases validated (if combat-related)
- [ ] Integration tests written (if applicable)
- [ ] Documentation updated
- [ ] **Feature references added** - All code references its feature
- [ ] **Existing code reviewed** - All related code was read before implementation

## ğŸ® Project-Specific Knowledge

### Type Effectiveness
- Gen 6+ chart (Fairy included)
- STAB = 1.5x multiplier
- Dual-type multiplies

### Stat Calculation  
- Gen 3+ formula
- HP formula different from other stats
- Nature = 0.9, 1.0, or 1.1 modifier

### Pokemon Data
- Blueprints in `Content/Catalogs/Pokemon/`
- Moves in `Content/Catalogs/Moves/`
- Effects implement `IMoveEffect`

### Feature Documentation

**âš ï¸ CRITICAL: Always use numbered feature format**

- **Features**: `docs/features/[N]-[feature-name]/` (e.g., `docs/features/2-combat-system/`)
- **Sub-Features**: `docs/features/[N]-[feature-name]/[N.M]-[sub-feature-name]/`
- **Display Names**: `Feature [N]: [Feature Name]` or `[N]: [Feature Name]`
- **Master Reference**: `docs/features_master_list.md`

**See**: `docs/feature_documentation_standard.md` for complete guide

### Feature Naming in Code

**âš ï¸ MANDATORY: ALL code must reference its feature**

- **When**: ALL classes and interfaces (no exceptions)
- **Format**: Add `<remarks>` section with feature number and documentation path
- **Example**:
  ```csharp
  /// <remarks>
  /// **Feature**: 2: Combat System
  /// **Sub-Feature**: 2.6: Combat Engine
  /// **Documentation**: See `docs/features/2-combat-system/2.6-combat-engine/architecture.md`
  /// </remarks>
  ```

**See**: `docs/ai/guidelines/feature_naming_in_code.md` for complete guidelines

### Code Reading Before Writing

**âš ï¸ MANDATORY: Never write code without reading existing code first**

- Read `code_location.md` to find where code lives
- Read all existing classes/interfaces in the feature's namespace
- Understand existing patterns, naming conventions, and structure
- Match existing code style and organization

**Rule**: If you haven't read the existing code, you cannot write new code

**See**: `docs/ai/guidelines/project_guidelines.md` Section 5.7 for complete guidelines

### Current Phase
- âœ… Phase 1: Core Data (Complete)
- âœ… Phase 2: Instances (Complete)  
- ğŸ¯ Phase 3: Combat System (In Progress)
