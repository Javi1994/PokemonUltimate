# PokemonUltimate - Cursor AI Rules

> **Quick reference for AI assistants. For detailed guidelines, see referenced documents.**

## üöÄ Automatic Context Loading

**ALWAYS read at start:**
1. `.ai/context.md` - Current project state
2. `docs/ai/guidelines/project_guidelines.md` - Complete coding rules

**Read on-demand:**
- Feature docs ‚Üí `docs/features_master_list_index.md` ‚≠ê **OPTIMIZED FOR AI** (or `docs/features_master_list.md` as fallback) ‚Üí `docs/features/[N]-[feature-name]/`
- Feature-driven development ‚Üí `ai_workflow/docs/FDD_GUIDE.md` ‚≠ê **MANDATORY** (or `docs/ai/guidelines/feature_driven_development.md`)
- TDD workflow ‚Üí `ai_workflow/docs/TDD_GUIDE.md` ‚≠ê **MANDATORY**
- Game Definition ‚Üí `ai_workflow/docs/GAME_DEFINITION_GUIDE.md` (for new projects)
- Smoke Tests ‚Üí `ai_workflow/docs/SMOKE_TESTS_GUIDE.md`
- Decision trees ‚Üí `ai_workflow/decision-trees/` ‚≠ê **EXECUTABLE WORKFLOWS**
- Code quality ‚Üí `docs/ai/anti-patterns.md`
- Examples ‚Üí `docs/ai/examples/good_code.md`
- Feature naming ‚Üí `docs/ai/guidelines/feature_naming_in_code.md`

## üìã Development Workflow

### When User Says "Implement X" or "Add X"

**‚ö†Ô∏è CRITICAL: Feature-Driven Development - ALWAYS start here**

**MANDATORY WORKFLOW:**

0. **Feature Discovery & Assignment** ‚≠ê **MUST DO FIRST**
   - **Follow decision tree**: `ai_workflow/decision-trees/feature-discovery.yaml` ‚≠ê **EXECUTABLE WORKFLOW**
   - **MANDATORY: Review existing features** - Read `docs/features_master_list_index.md` ‚≠ê **OPTIMIZED FOR AI** (or `docs/features_master_list.md` as fallback)
   - **Semantic search**: Use `codebase_search` to find features related to user request
   - **Check if work fits existing feature:**
     - If YES ‚Üí Read that feature's documentation (`README.md`, `architecture.md`, `roadmap.md`, `code_location.md`, `testing.md`, `use_cases.md`)
     - If NO ‚Üí Create new feature or sub-feature (see below)
   - **For new features/sub-features:**
     - Determine feature number (check `features_master_list.md` for next available)
     - Create feature folder: `docs/features/[N]-[feature-name]/`
     - Create complete documentation structure:
       - `README.md` - Feature overview
       - `architecture.md` - Technical specification
       - `roadmap.md` - Implementation plan
       - `use_cases.md` - All scenarios
       - `testing.md` - Testing strategy
       - `code_location.md` - Where code lives
     - For sub-features: Create `[N.M]-[sub-feature-name]/` folder with `README.md` (and `architecture.md` if complex)
     - Update `docs/features_master_list.md` and `docs/features_master_list_index.md` with new feature/sub-feature entry
     - Follow `docs/feature_documentation_standard.md` for structure
   - **Once feature assigned:** Proceed with standard workflow below

1. **Read Context & Specs**
   - Read `.ai/context.md` and `docs/features_master_list.md`
   - Read assigned feature's documentation (`README.md`, `architecture.md`, `roadmap.md`)
   - **MANDATORY: Read existing code** - See `code_location.md`, read all related classes
   - Understand existing patterns before writing

2. **Verify Spec Completeness**
   - List what to implement vs defer
   - Complete spec if incomplete

3. **TDD: Write Tests FIRST** ‚≠ê **FOLLOW DECISION TREE**
   - **Follow decision tree**: `ai_workflow/decision-trees/tdd-workflow.yaml` ‚≠ê **EXECUTABLE WORKFLOW**
   - **Determine test type**: Functional / Edge Cases / Integration
   - **Use templates**: `ai_workflow/templates/tests/functional-template.md` (or edgecases/integration)
   - Follow `docs/ai/testing_structure_definition.md`
   - Write functional tests (red phase)
   - **Verify test FAILS** (red phase) - If test passes ‚Üí ERROR: Review test or implementation

4. **Implement Feature** (Green Phase)
   - **MANDATORY: Read existing code first** - Match style and patterns
   - **MANDATORY: Add feature references** - ALL code must reference its feature (see `docs/ai/guidelines/feature_naming_in_code.md`)
   - Follow spec and existing patterns
   - Write minimal code to make tests pass (green phase)
   - **Verify test PASSES** (green phase) - If test fails ‚Üí Fix implementation, retry

5. **Write Edge Case Tests**
   - Use template: `ai_workflow/templates/tests/edgecases-template.md`
   - Read feature's `use_cases.md` for edge cases
   - Test boundaries and invalid inputs
   - Implement missing functionality if discovered (Test-Driven Discovery)

6. **Write Integration Tests** (if feature interacts with multiple systems)
   - Use template: `ai_workflow/templates/tests/integration-template.md`
   - Test system interactions
   - Place in `Tests/[Feature]/Integration/[Category]/`

7. **Refactor** (if needed)
   - Improve code without changing behavior
   - All tests must still pass
   - Follow `docs/ai/guidelines/project_guidelines.md`
   - Avoid `docs/ai/anti-patterns.md`

8. **Validate Implementation** ‚≠ê **OBLIGATORY - EXECUTE ALL VALIDATIONS**
   - **MANDATORY: Run validation scripts** (must exit with code 0):
     - `ai_workflow/scripts/validate-test-structure.ps1 -TestDir PokemonUltimate.Tests` ‚Üí Must exit code 0
     - `ai_workflow/scripts/validate-fdd-compliance.ps1 -CodeDir . -FeaturesDir docs/features -MasterList docs/features_master_list.md` ‚Üí Must exit code 0
     - If any script fails ‚Üí Fix issues, retry. DO NOT continue until all pass.
   - **Build validation**: `dotnet build` - 0 warnings, 0 errors
   - **Test validation**: `dotnet test` - All tests pass
   - Check `docs/ai/checklists/feature_complete.md`
   - **CRITICAL**: Only proceed to next step when ALL validations pass

9. **Check for Smoke Tests Creation** ‚≠ê **AUTOMATIC**
   - **Criteria**: 5+ main features completed OR phase completed
   - **If criteria met**:
     - Check if smoke tests project exists (`PokemonUltimate.SmokeTests`)
     - If not ‚Üí Create project and add to solution
     - Use template: `ai_workflow/templates/tests/smoke-template.md`
     - Create smoke tests for completed features
     - Verify happy path works
     - Run smoke tests
   - **See**: `ai_workflow/docs/SMOKE_TESTS_GUIDE.md` for details

9. **Update Documentation** ‚≠ê **MANDATORY AFTER EVERY FEATURE**
   - Update `.ai/context.md` with current state
   - Update feature's `roadmap.md` - Mark completed phases/sub-features
   - Update feature's `architecture.md` if implementation differs from spec
   - Update feature's `use_cases.md` - Mark completed use cases
   - Update feature's `code_location.md` - Add new files/classes
   - Update feature's `testing.md` - Document new tests
   - Update `docs/features_master_list.md` if feature status changed
   - **CRITICAL**: Documentation must reflect actual implementation state

### When User Says "Define game" or "What is this game?"
**Follow Game Definition workflow** ‚≠ê **CRITICAL FOR NEW PROJECTS**
- **Follow decision tree**: `ai_workflow/decision-trees/game-definition.yaml` ‚≠ê **EXECUTABLE WORKFLOW**
- **Use template**: `ai_workflow/templates/game-definition-template.yaml`
- **Process**:
  1. Check if `docs/GAME_DEFINITION.yaml` exists
  2. If not ‚Üí Define game basics, core concepts, generate features
  3. If exists ‚Üí Check user intent (redefine/improve vs validate)
  4. Generate `docs/features_master_list.md` and `docs/features_master_list_index.md`
  5. If 5+ features or 20+ sub-features ‚Üí Create `docs/CODE_ORGANIZATION.md`
- **See**: `ai_workflow/docs/GAME_DEFINITION_GUIDE.md` for complete guide

### When User Says "Review X" or "Check X"
1. Read `docs/ai/anti-patterns.md`
2. Verify against `docs/ai/guidelines/project_guidelines.md`
3. Check `docs/ai/checklists/feature_complete.md`
4. Run validation scripts if needed
5. List issues and fix if requested

### When User Says "Refactor X" or "Improve X"
1. **Read current implementation** - All related code files
2. Identify improvements, check `docs/ai/anti-patterns.md`
3. Make small incremental changes
4. Run tests after each change
5. **Ensure feature references exist** - All code must reference its feature

### When Issues Arise

**Spec incomplete** ‚Üí Complete spec first  
**Spec incorrect** ‚Üí Document discrepancy, fix spec or implementation  
**Test reveals missing functionality** ‚Üí Implement immediately (Test-Driven Discovery)  
**Architectural change needed** ‚Üí Document discovery, evaluate impact, update architecture

## ‚úÖ Mandatory Rules

### Code Quality
- **NO magic strings** ‚Üí Use `ErrorMessages.cs` or `GameMessages.cs`
- **NO magic numbers** ‚Üí Use named constants
- **NO try-catch** ‚Üí Unless absolutely necessary (I/O, external APIs)
- **Fail-fast** ‚Üí Throw exceptions for invalid inputs
- **Guard clauses** ‚Üí Validate at method start

### Architecture
- **Core/** ‚Üí Logic only, NO game data
- **Content/** ‚Üí Game data, catalogs, builders
- **Tests/** ‚Üí Systems/, Blueprints/, Data/ (see `docs/ai/testing_structure_definition.md`)
- **Blueprints** ‚Üí Immutable (no setters)
- **Instances** ‚Üí Mutable runtime state

### Testing
- **TDD** ‚Üí Tests before implementation
- **Three-phase** ‚Üí Functional ‚Üí Edge Cases ‚Üí Integration
- **Naming** ‚Üí `MethodName_Scenario_ExpectedResult`
- **Test-Driven Discovery** ‚Üí If test reveals missing functionality, implement it
- **Structure** ‚Üí Follow `docs/ai/testing_structure_definition.md`

### Documentation
- **XML docs** ‚Üí All public APIs
- **MANDATORY: Feature references** ‚Üí ALL classes must reference their feature (see `docs/ai/guidelines/feature_naming_in_code.md`)
- **MANDATORY: Read before write** ‚Üí Never write code without reading existing code first
- **MANDATORY: Match existing patterns** ‚Üí Follow style, naming, structure of existing code
- **Update context** ‚Üí After major features

## üîç Quick Reference

### Exception Messages
```csharp
throw new ArgumentException(ErrorMessages.AmountCannotBeNegative, nameof(amount));
```

### Test Pattern
```csharp
[Test]
public void MethodName_Scenario_ExpectedResult() { /* Arrange, Act, Assert */ }
```

### Validation Pattern
```csharp
public void Method(int value) {
    if (value < 0)
        throw new ArgumentException(ErrorMessages.ValueCannotBeNegative, nameof(value));
    // Main logic
}
```

## üìÅ Key Files Reference

| Need | Read |
|------|------|
| Project state | `.ai/context.md` |
| Feature numbers/names | `docs/features_master_list_index.md` ‚≠ê **OPTIMIZED FOR AI** (or `docs/features_master_list.md`) |
| Game definition | `docs/GAME_DEFINITION.yaml` |
| Feature documentation standard | `docs/feature_documentation_standard.md` |
| Feature naming in code | `docs/ai/guidelines/feature_naming_in_code.md` ‚≠ê **MANDATORY** |
| Coding rules | `docs/ai/guidelines/project_guidelines.md` |
| What NOT to do | `docs/ai/anti-patterns.md` |
| Code examples | `docs/ai/examples/good_code.md` |
| Test examples | `docs/ai/examples/good_tests.md` |
| Pre-implementation | `docs/ai/checklists/pre_implementation.md` |
| Feature checklist | `docs/ai/checklists/feature_complete.md` |
| Test structure | `docs/ai/testing_structure_definition.md` |
| **Workflow Guides** | |
| FDD Guide | `ai_workflow/docs/FDD_GUIDE.md` ‚≠ê **MANDATORY** |
| TDD Guide | `ai_workflow/docs/TDD_GUIDE.md` ‚≠ê **MANDATORY** |
| Game Definition Guide | `ai_workflow/docs/GAME_DEFINITION_GUIDE.md` |
| Smoke Tests Guide | `ai_workflow/docs/SMOKE_TESTS_GUIDE.md` |
| **Decision Trees** | |
| Feature Discovery | `ai_workflow/decision-trees/feature-discovery.yaml` ‚≠ê **EXECUTABLE** |
| TDD Workflow | `ai_workflow/decision-trees/tdd-workflow.yaml` ‚≠ê **EXECUTABLE** |
| Game Definition | `ai_workflow/decision-trees/game-definition.yaml` ‚≠ê **EXECUTABLE** |
| **Templates** | |
| Functional Tests | `ai_workflow/templates/tests/functional-template.md` |
| Edge Cases | `ai_workflow/templates/tests/edgecases-template.md` |
| Integration | `ai_workflow/templates/tests/integration-template.md` |
| Smoke Tests | `ai_workflow/templates/tests/smoke-template.md` |
| **Validation Scripts** | |
| Test Structure | `ai_workflow/scripts/validate-test-structure.ps1` ‚≠ê **MANDATORY** |
| FDD Compliance | `ai_workflow/scripts/validate-fdd-compliance.ps1` ‚≠ê **MANDATORY** |

**‚ö†Ô∏è Feature Documentation**: Always use numbered paths: `docs/features/[N]-[feature-name]/`

## üîÑ After Completing Work

Always:
1. **Run validation scripts** (MANDATORY):
   - `ai_workflow/scripts/validate-test-structure.ps1 -TestDir PokemonUltimate.Tests` ‚Üí Must exit code 0
   - `ai_workflow/scripts/validate-fdd-compliance.ps1 -CodeDir . -FeaturesDir docs/features -MasterList docs/features_master_list.md` ‚Üí Must exit code 0
2. Run `dotnet build` - Verify 0 warnings, 0 errors
3. Run `dotnet test` - Verify all pass
4. Update `.ai/context.md` if major changes
5. Update `docs/features_master_list_index.md` if feature status changed
6. Mention test count in response
7. Verify against `docs/ai/checklists/feature_complete.md`

## ‚ö° Quick Verification Checklist

Before marking feature complete:
- [ ] **Validation scripts passed** (exit code 0):
  - [ ] `validate-test-structure.ps1` passed
  - [ ] `validate-fdd-compliance.ps1` passed
- [ ] All tests pass (`dotnet test`)
- [ ] No warnings (`dotnet build`)
- [ ] `.ai/context.md` updated
- [ ] `docs/features_master_list_index.md` updated (if feature status changed)
- [ ] Use cases validated (if combat-related)
- [ ] Integration tests written (if applicable)
- [ ] Smoke tests created/updated (if 5+ features or phase complete)
- [ ] Documentation updated (roadmap, architecture, use_cases, code_location, testing)
- [ ] **Feature references added** - All code references its feature
- [ ] **Existing code reviewed** - All related code was read before implementation
- [ ] **Decision trees followed** - Feature Discovery and TDD workflows executed

## üéÆ Project-Specific Knowledge

### Type Effectiveness
- Gen 6+ chart (Fairy included)
- STAB = 1.5x multiplier
- Dual-type multiplies

### Stat Calculation  
- Gen 3+ formula
- HP formula different from other stats
- Nature = 0.9, 1.0, or 1.1 modifier

### Pokemon Data
- Blueprints in `Content/Catalogs/Pokemon/`
- Moves in `Content/Catalogs/Moves/`
- Effects implement `IMoveEffect`

### Feature Documentation

**‚ö†Ô∏è CRITICAL: Always use numbered feature format**

- **Features**: `docs/features/[N]-[feature-name]/` (e.g., `docs/features/2-combat-system/`)
- **Sub-Features**: `docs/features/[N]-[feature-name]/[N.M]-[sub-feature-name]/`
- **Display Names**: `Feature [N]: [Feature Name]` or `[N]: [Feature Name]`
- **Master Reference**: `docs/features_master_list.md`

**See**: `docs/feature_documentation_standard.md` for complete guide

### Feature Naming in Code

**‚ö†Ô∏è MANDATORY: ALL code must reference its feature**

- **When**: ALL classes and interfaces (no exceptions)
- **Format**: Add `<remarks>` section with feature number and documentation path
- **Example**:
  ```csharp
  /// <remarks>
  /// **Feature**: 2: Combat System
  /// **Sub-Feature**: 2.6: Combat Engine
  /// **Documentation**: See `docs/features/2-combat-system/2.6-combat-engine/architecture.md`
  /// </remarks>
  ```

**See**: `docs/ai/guidelines/feature_naming_in_code.md` for complete guidelines

### Code Reading Before Writing

**‚ö†Ô∏è MANDATORY: Never write code without reading existing code first**

- Read `code_location.md` to find where code lives
- Read all existing classes/interfaces in the feature's namespace
- Understand existing patterns, naming conventions, and structure
- Match existing code style and organization

**Rule**: If you haven't read the existing code, you cannot write new code

**See**: `docs/ai/guidelines/project_guidelines.md` Section 5.7 for complete guidelines

### Current Phase
- ‚úÖ Phase 1: Core Data (Complete)
- ‚úÖ Phase 2: Instances (Complete)  
- üéØ Phase 3: Combat System (In Progress)
